@page "/"
@using TicketSystem.Data
@using Microsoft.EntityFrameworkCore
@inject IDbContextFactory<ApplicationDbContext> DbFactory

<style>
    .hero-section {
        background-color: #f8f9fa; 
        border: 2px solid #dee2e6; 
        border-radius: 25px;
        padding: 40px;
        margin-bottom: 30px;
    }

    .stat-card {
        border-radius: 20px;
        transition: transform 0.2s;
        border: 2px solid #dee2e6;
        background: white;
    }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

    .action-card {
        border-radius: 20px;
        cursor: pointer;
        text-decoration: none;
        color: inherit;
        display: block;
        padding: 30px;
        border: 2px solid #dee2e6;
        background: white;
        transition: all 0.2s;
    }

        .action-card:hover {
            border-color: #0d6efd;
            background-color: #f0f7ff;
            color: #0d6efd;
        }

    .action-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        display: block;
    }
</style>

<div class="container animate-fadeIn">

    
    <div class="hero-section shadow-sm text-center">
        <h1 class="display-5 fw-bold" style="color: black; text-decoration: underline;">Ticket Management System</h1>
        <p class="lead text-muted">A robust, secure platform for tracking support requests and system history.</p>
        <div class="badge bg-dark px-3 py-2">Capstone Project v1.0</div>
    </div>

    
    <div class="row mb-5 text-center">
        <div class="col-md-4 mb-3">
            <div class="stat-card p-3 shadow-sm">
                <h6 class="text-uppercase text-muted">Open Tickets</h6>
                <h2 class="fw-bold text-primary">@openCount</h2>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="stat-card p-3 shadow-sm">
                <h6 class="text-uppercase text-muted">In Progress</h6>
                <h2 class="fw-bold text-warning">@progressCount</h2>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="stat-card p-3 shadow-sm">
                <h6 class="text-uppercase text-muted">Total Resolved</h6>
                <h2 class="fw-bold text-success">@closedCount</h2>
            </div>
        </div>
    </div>

    
    <div class="row g-4 text-center">
        <div class="col-md-6">
            <a href="/create" class="action-card shadow-sm">
                <i class="bi bi-plus-circle action-icon text-success"></i>
                <h4 class="fw-bold">Create New Ticket</h4>
                <p class="text-muted">Initiate a new support request in the system.</p>
            </a>
        </div>
        <div class="col-md-6">
            <a href="/retrieve" class="action-card shadow-sm">
                <i class="bi bi-search action-icon text-primary"></i>
                <h4 class="fw-bold">Find & Update</h4>
                <p class="text-muted">Search by ID to view history or update status.</p>
            </a>
        </div>
    </div>
    
    <div class="mt-5 p-4 text-center border-top">
        <small class="text-muted">Built with: .NET 8.0 • Blazor Interactive Server • Entity Framework Core • SQLite</small>
    </div>
</div>

@code {
    private int openCount = 0;
    private int progressCount = 0;
    private int closedCount = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            using var context = await DbFactory.CreateDbContextAsync();

            // Get live counts from SQLite
            openCount = await context.Tickets.CountAsync(t => t.Status == "Open");
            progressCount = await context.Tickets.CountAsync(t => t.Status == "In Progress");
            closedCount = await context.Tickets.CountAsync(t => t.Status == "Closed");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading stats: {ex.Message}");
        }
    }
}
